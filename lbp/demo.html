<!DOCTYPE html>
<html>
<body>
<h1>Local Binary Pattern</h1>
<canvas id="canvasImage"></canvas>
<canvas id="canvasLBP"></canvas>
<div>
<label for="radius">Radius</label>
<input id="radius" type="range" min="1" max="32" value="4" oninput="update()" />
<output for="radius" id="radiusOutput"></output>
</div>
<div>
<label for="threshold">Threshold</label>
<input id="threshold" type="range" min="1" max="255" value="64" oninput="update()" />
<output for="threshold" id="thresholdOutput"></output>
</div>

<script>
function Matrix(numRows, numCols) {
    this.m = numRows;
    this.n = numCols;
    this.data = new Array(numRows*numCols);
    var i;
    for (i = 0; i < numRows*numCols; ++i) this.data[i] = 0;
}

function drawImage(I, canvas) {
    canvas.width = I.n;
    canvas.height = I.m;
    var ctx = canvas.getContext("2d");
    var imageData = ctx.createImageData(I.n, I.m);
    var i, j;
    for (i = 0; i < I.m; ++i) {
        for (j = 0; j < I.n; ++j) {
            imageData.data[4*(i*I.n + j)] = I.data[i*I.n + j];
            imageData.data[4*(i*I.n + j) + 1] = I.data[i*I.n + j];
            imageData.data[4*(i*I.n + j) + 2] = I.data[i*I.n + j];
            imageData.data[4*(i*I.n + j) + 3] = 255;
        }
    }
    ctx.putImageData(imageData, 0, 0);
}

// example image
var gImage = new Matrix(40,144);
gImage.data = [
43,54,66,52,54,54,57,45,43,52,43,34,57,70,70,41,73,63,54,54,54,50,61,52,61,59,
47,47,57,61,47,43,66,47,57,36,63,59,77,36,41,52,57,38,52,63,66,52,54,61,59,59,
52,61,45,47,38,45,52,43,36,52,59,50,43,54,43,68,41,61,54,70,41,43,41,61,38,59,
47,61,38,45,50,54,57,66,73,100,121,155,171,185,132,70,0,29,68,130,91,57,2,15,
13,68,153,219,221,201,82,27,0,11,0,0,0,13,6,77,146,253,233,228,194,173,84,25,
6,22,34,41,34,57,91,178,201,191,148,164,141,107,63,52,4,36,37,65,63,70,61,53,
65,51,61,39,44,37,72,61,56,46,58,63,58,58,65,65,44,49,68,56,53,58,51,65,51,56,
58,68,53,46,63,63,49,49,70,72,58,49,61,63,56,56,58,49,56,56,39,51,58,61,46,65,
53,68,68,68,51,70,72,53,53,56,63,63,58,56,49,49,44,56,56,65,61,56,46,58,56,75,
46,70,61,98,117,147,171,194,133,70,4,30,58,122,96,49,9,23,21,65,161,220,246,
199,82,39,0,16,0,0,0,0,7,75,159,246,253,248,204,178,103,46,18,35,28,18,16,44,
86,183,206,192,152,180,133,112,63,63,4,51,68,98,81,68,63,86,63,59,86,78,63,71,
78,91,76,66,71,61,86,63,66,66,88,71,63,61,78,61,66,66,71,73,71,81,66,81,66,76,
61,78,81,68,68,71,78,76,68,81,73,68,59,54,66,73,59,66,71,71,71,66,61,61,56,61,
81,78,56,78,68,76,59,76,56,68,56,49,68,81,54,63,61,71,73,78,59,86,91,105,103,
162,177,211,179,115,17,9,29,147,182,110,39,17,0,31,73,152,201,253,184,118,22,
0,4,0,7,0,0,14,41,172,226,243,233,241,209,127,17,0,2,19,0,19,9,83,135,115,63,
125,177,199,105,44,19,19,87,105,65,87,87,67,77,77,102,67,90,92,82,67,80,80,102,
85,90,102,82,85,87,85,90,90,97,75,85,77,87,75,82,75,75,95,85,77,72,85,80,80,70,
92,97,87,85,87,100,97,92,92,87,87,72,75,95,82,57,77,92,85,65,80,77,85,80,67,70,
72,82,85,80,102,92,95,77,90,85,100,80,85,80,90,67,75,67,62,97,137,170,200,170,
130,17,0,17,115,183,208,100,45,7,0,22,70,122,198,253,238,147,82,7,0,7,0,0,5,25,
82,137,190,208,230,253,225,115,17,2,0,2,17,0,15,80,120,115,142,213,250,193,115,
112,32,97,85,80,25,107,92,97,100,82,67,75,60,85,90,67,75,97,90,92,82,97,85,85,
80,97,77,82,87,85,92,80,80,70,92,87,92,92,85,80,87,92,97,112,105,90,100,97,90,
122,97,90,95,102,75,72,100,97,82,100,85,90,65,72,87,92,90,87,87,95,87,100,80,
90,77,90,75,90,77,75,67,92,102,85,95,82,85,60,80,62,87,142,198,188,163,67,0,0,
25,112,228,175,85,22,35,0,5,32,127,198,253,243,213,92,50,22,0,0,0,0,0,42,120,
203,235,255,255,200,62,0,0,0,5,0,0,22,127,183,230,255,255,255,218,193,72,71,87,
100,100,87,73,73,76,91,69,89,103,96,78,98,114,105,91,98,87,105,105,96,103,96,
71,80,69,76,71,69,71,82,96,78,85,94,89,89,94,94,87,87,82,91,89,91,82,96,98,105,
105,87,73,89,87,80,78,94,94,62,73,85,94,89,89,85,96,96,87,87,103,91,78,87,85,
69,87,82,73,87,107,96,80,82,96,73,76,47,67,62,123,136,174,116,53,0,0,65,177,
195,136,65,26,0,0,20,51,116,188,253,239,188,127,78,26,0,2,8,6,0,26,112,163,208,
255,230,152,62,13,17,22,0,2,17,71,107,139,186,246,255,253,230,154,87,99,89,101,
78,89,78,89,76,91,83,87,81,78,95,85,103,93,93,97,89,95,93,97,83,83,85,68,87,85,
81,72,91,72,78,76,95,89,83,87,91,83,72,81,97,89,93,89,81,87,83,91,81,76,93,95,
78,81,68,93,74,89,89,89,81,95,74,74,76,95,83,78,76,91,74,70,83,93,93,103,76,97,
93,87,85,103,72,66,39,39,16,31,116,191,201,135,45,0,6,93,180,184,126,49,18,0,0,
0,31,93,187,224,253,241,182,97,18,0,0,0,0,8,33,81,101,184,228,222,143,58,4,2,2,
2,20,35,27,49,97,164,228,247,234,228,72,97,119,115,88,97,119,104,61,61,90,85,
42,56,85,74,90,101,83,88,83,85,88,83,76,85,88,65,90,92,88,74,99,83,108,92,83,
63,88,74,92,79,90,90,92,88,79,88,88,85,99,99,81,76,81,83,83,67,58,72,104,92,88,
88,101,81,94,97,74,58,76,79,85,74,79,85,99,101,88,97,88,106,94,104,67,88,74,70,
54,40,0,0,33,137,196,208,119,36,0,13,104,185,171,97,36,24,15,15,0,36,97,174,
228,253,246,169,88,33,11,0,0,0,0,0,9,83,183,237,255,189,108,52,29,31,15,27,6,6,
4,63,162,203,180,242,118,98,98,114,29,87,96,100,33,96,94,96,78,136,143,152,76,
91,73,105,94,65,89,71,116,80,87,105,96,98,94,107,89,91,91,118,80,73,91,85,82,
82,100,98,96,87,98,96,98,85,82,91,100,103,91,98,82,78,89,94,91,105,98,98,96,91,
87,103,87,91,78,103,82,91,87,103,103,107,89,98,94,89,105,100,109,103,89,94,71,
31,0,0,0,29,141,192,183,107,26,0,40,132,213,201,96,33,11,20,2,8,20,78,168,239,
253,239,165,69,4,0,8,0,0,0,0,13,78,181,255,255,233,174,67,31,20,20,8,6,0,20,65,
130,103,201,105,99,109,109,81,85,99,89,93,77,81,89,71,79,79,85,95,91,99,95,93,
85,87,87,85,79,85,85,75,79,79,83,91,95,101,89,81,93,87,89,95,81,103,93,71,73,
85,75,91,79,77,85,87,85,99,93,77,93,95,91,87,79,93,93,87,95,105,93,79,83,89,89,
71,79,89,93,79,87,105,99,87,95,93,89,95,89,89,85,77,56,0,0,0,0,48,127,178,138,
48,22,42,65,154,227,199,125,40,26,0,2,0,22,71,148,217,249,253,178,99,42,22,2,2,
0,0,12,42,107,207,255,255,255,170,93,40,36,24,14,26,12,12,50,56,109,98,102,90,
88,106,100,96,84,90,104,90,84,88,102,80,84,114,104,110,108,106,92,96,110,98,94,
98,96,110,100,98,112,106,106,106,108,100,100,88,96,108,102,98,106,90,104,94,98,
94,102,94,92,94,108,96,104,96,100,112,90,84,112,96,90,98,114,100,96,94,98,100,
112,86,102,96,100,86,102,104,98,98,98,98,94,86,112,102,102,100,80,6,0,0,0,6,64,
129,141,50,34,24,42,76,195,235,187,76,20,2,16,0,8,10,66,157,219,235,253,181,
94,0,0,0,0,0,0,12,46,110,193,255,255,255,193,84,36,12,2,2,0,2,24,10,42,76,54,
44,54,78,82,83,64,85,93,89,80,83,87,91,76,74,83,89,91,76,85,97,91,89,85,93,99,
83,82,95,89,82,91,76,83,83,89,85,83,93,93,93,91,87,87,85,91,99,101,89,89,83,87,
91,89,87,97,85,89,95,89,78,78,93,74,91,89,93,82,87,85,87,87,93,83,82,74,83,76,
74,76,87,80,68,76,85,97,91,82,33,0,0,0,17,39,56,95,80,29,11,13,21,85,173,201,
162,68,46,25,0,0,5,35,64,132,195,253,242,189,74,21,0,0,0,17,9,23,64,125,173,
232,255,255,167,82,19,1,0,0,1,27,0,17,95,98,61,63,134,108,132,183,138,138,134,
153,70,83,78,66,85,81,91,81,66,74,83,81,72,78,91,89,63,81,87,81,89,89,81,85,83,
83,78,76,85,74,87,81,72,74,76,74,89,89,87,81,85,78,76,89,87,83,68,87,87,74,68,
87,66,66,72,81,72,72,70,61,93,93,87,83,83,83,76,87,83,72,66,66,66,66,74,87,91,
93,72,21,0,0,6,8,0,40,38,29,12,4,6,42,85,172,200,136,53,14,0,0,8,4,21,44,140,
215,251,253,183,98,25,0,0,4,0,4,25,46,72,134,234,255,255,172,76,17,2,0,0,4,0,0,
99,97,85,97,82,101,71,85,75,85,80,87,78,82,92,78,73,82,73,75,75,80,78,94,82,104,
101,99,97,115,87,108,101,104,106,92,87,89,82,61,85,104,82,85,85,104,99,68,85,
99,78,94,92,94,82,87,97,106,94,97,61,89,73,94,82,82,78,85,59,68,54,66,75,104,
99,106,111,130,120,101,113,111,108,97,82,82,73,85,94,115,144,108,49,28,9,4,0,18,
40,37,16,28,26,35,75,113,224,227,151,54,7,0,0,0,0,23,87,170,220,253,239,201,
120,63,30,11,0,9,42,44,47,85,158,229,255,255,220,132,56,11,4,2,28,28,104,104,
130,112,78,96,96,91,80,88,112,73,99,101,114,99,112,106,104,109,80,96,96,91,125,
112,106,112,88,99,96,101,96,101,106,99,93,104,109,104,88,101,96,101,101,104,
91,96,96,104,109,117,112,86,101,101,99,112,96,99,112,104,88,96,86,96,83,96,112,
86,99,112,109,114,101,104,127,117,99,125,106,127,93,112,93,75,75,88,83,99,135,
159,182,167,93,31,13,0,20,36,31,20,41,65,46,70,164,253,234,135,28,0,0,0,0,0,7,
44,122,206,250,232,245,213,101,10,0,0,7,33,26,46,57,127,206,255,255,255,206,
104,2,2,0,0,102,104,117,107,97,92,84,71,63,69,79,48,71,86,86,79,63,69,81,79,89,
79,99,86,89,81,92,94,92,86,99,76,92,102,86,79,94,79,110,79,89,86,97,81,81,74,
86,61,89,102,86,89,92,97,92,86,92,94,89,86,56,63,48,56,56,61,63,63,79,89,92,92,
92,92,94,89,94,79,97,89,86,84,81,76,74,63,48,53,43,46,86,143,202,214,173,94,12,
0,15,25,48,25,38,46,43,7,40,138,253,214,127,46,0,0,0,0,2,0,30,97,181,240,245,
250,194,89,5,0,0,0,5,0,38,35,99,202,255,255,255,202,110,53,12,0,58,50,63,84,71,
71,42,60,65,87,50,60,39,50,44,58,47,50,60,52,73,65,79,60,81,71,68,76,60,58,58,
60,79,68,63,73,73,79,68,71,76,47,58,55,63,50,52,71,65,60,65,63,71,63,68,58,65,
71,65,73,60,65,44,68,65,60,65,68,65,50,44,63,58,68,79,71,60,60,71,87,71,71,68,
76,47,44,44,47,15,0,15,81,147,232,253,189,108,26,36,23,89,105,58,47,18,0,0,60,
158,226,234,158,110,34,0,0,0,0,0,0,87,189,253,255,255,226,113,23,0,0,2,0,0,7,31,
123,239,255,255,255,239,163,110,39,108,127,106,111,70,33,74,72,103,101,82,91,
94,91,96,98,72,70,77,79,82,94,94,96,77,82,96,94,72,89,72,89,89,89,94,84,91,96,
91,98,86,79,79,91,77,74,86,60,82,89,84,86,94,89,84,89,74,86,77,79,74,77,72,89,
70,74,72,77,82,77,84,79,96,86,94,74,84,79,101,84,86,91,79,94,74,77,62,38,16,0,
0,0,86,188,251,253,222,147,118,115,156,181,132,65,24,2,0,0,60,137,207,229,210,
123,28,16,7,4,0,0,33,106,190,255,255,255,222,161,36,26,24,7,9,16,16,82,156,219,
253,255,255,255,224,154,0,0,0,0,123,99,121,110,103,110,107,125,72,61,72,88,74,
63,57,68,92,68,77,79,74,79,61,72,83,77,66,81,81,81,81,81,68,81,77,83,57,72,72,
66,55,83,63,79,77,88,74,63,68,77,63,63,66,55,72,70,81,96,79,81,68,70,72,70,70,
77,70,72,72,74,90,61,61,63,74,57,66,66,57,63,85,61,59,61,22,0,0,0,4,83,187,253,
244,174,121,90,127,169,191,141,61,30,0,0,19,79,147,213,248,215,136,44,28,15,13,
4,15,17,114,202,255,255,255,213,136,68,22,24,4,0,35,63,79,112,174,213,248,255,
253,207,95,102,95,112,92,82,85,90,97,92,87,104,85,80,80,95,95,95,90,85,75,85,
82,87,104,107,95,104,99,104,99,104,87,80,104,82,97,99,109,109,92,97,107,92,85,
80,87,92,85,87,90,90,107,97,104,92,92,90,102,97,95,87,95,90,99,99,60,73,95,99,
95,82,114,104,90,102,107,92,87,97,97,92,78,99,90,82,75,48,58,14,0,0,0,24,95,192,
236,199,107,51,48,112,175,209,153,92,24,7,0,0,26,121,226,253,241,136,36,26,21,
24,0,0,21,82,190,246,251,204,168,131,46,14,14,24,29,36,19,41,51,70,141,236,234,
197,56,47,68,63,47,68,52,63,54,61,66,71,49,66,75,68,52,42,49,49,63,54,59,63,63,
52,66,66,71,42,63,73,71,78,61,63,61,59,61,61,54,54,42,52,66,56,66,61,66,47,59,
78,68,61,63,71,47,42,44,54,75,61,63,68,68,61,49,56,68,61,49,52,59,56,59,56,68,
61,44,40,49,63,59,49,68,71,82,73,61,28,2,2,0,0,0,66,144,179,115,37,18,28,63,134,
191,175,87,23,0,0,0,26,125,201,253,215,97,23,11,0,0,0,0,4,40,139,198,146,99,97,
89,35,40,26,73,33,26,0,0,0,30,104,196,137,115,110,110,115,103,95,91,108,93,86,
83,78,76,83,71,73,98,93,93,91,68,78,76,63,95,113,100,98,93,113,98,95,91,98,88,
93,105,108,98,105,86,91,95,98,95,91,88,110,83,88,95,103,88,81,83,103,103,93,105,
103,103,103,120,123,110,120,118,110,105,110,103,100,83,93,71,83,91,81,88,78,93,
86,98,86,98,98,123,110,105,83,78,46,7,0,0,24,88,187,199,125,56,49,36,63,123,
201,169,71,22,19,0,0,46,105,206,253,243,147,83,36,0,0,0,0,4,54,132,184,150,100,
113,125,61,39,68,61,36,7,0,0,7,61,123,174,98,103,98,82,113,111,106,120,108,111,
98,106,106,113,91,115,98,108,108,111,98,108,101,108,106,98,86,98,108,108,118,
115,91,106,103,96,98,98,115,96,101,118,111,101,118,120,115,130,106,103,108,103,
94,98,108,111,103,115,106,106,106,113,118,118,106,115,130,106,96,101,106,96,101,
101,111,106,91,96,96,98,101,96,106,94,108,111,123,125,127,123,115,94,55,16,0,0,
48,137,210,207,91,38,24,19,55,120,168,127,65,21,0,0,0,31,82,183,248,253,195,
108,28,21,19,0,0,24,33,82,168,185,217,212,130,24,28,24,16,4,0,0,0,0,41,94,65,
92,83,67,79,95,72,72,95,97,90,88,60,72,65,55,83,74,79,72,74,65,85,83,83,85,97,
81,72,81,90,74,72,62,81,74,72,67,76,72,92,81,95,90,92,72,97,88,90,79,88,60,85,
76,81,69,83,76,72,67,92,85,104,76,92,81,90,76,76,88,79,88,55,72,72,76,79,76,95,
74,79,69,76,72,69,62,76,90,109,118,132,118,90,44,2,13,6,39,125,169,169,111,90,
58,60,65,90,130,123,37,0,0,0,0,0,53,167,239,253,223,146,58,4,0,0,0,0,16,72,151,
255,255,225,74,18,6,2,0,0,16,2,0,0,6,82,97,91,104,88,97,95,102,77,82,86,82,68,
86,77,88,84,93,93,97,82,91,84,102,86,88,73,91,84,102,84,88,93,86,73,86,102,100,
82,97,86,86,64,93,100,95,84,91,68,82,80,88,84,95,88,108,71,71,82,86,84,93,95,
117,88,93,82,93,80,84,86,88,86,77,80,82,93,88,82,91,88,93,75,97,71,60,80,93,100,
108,137,142,140,95,53,24,0,0,28,117,180,200,188,164,142,115,51,86,117,128,71,
17,0,0,0,20,84,160,231,253,237,164,46,0,0,6,0,6,0,48,160,237,255,166,71,11,6,0,
0,0,11,0,0,0,88,90,81,92,79,88,70,66,83,75,73,62,75,79,77,64,60,70,81,75,83,90,
90,88,73,81,85,92,70,64,70,77,70,73,75,66,79,77,92,68,75,70,77,83,88,92,96,85,
70,79,58,81,92,85,77,90,79,79,70,77,105,96,83,94,85,70,75,79,79,64,68,73,85,75,
88,83,85,79,96,94,96,81,94,79,79,58,77,75,68,100,124,113,116,126,120,42,19,0,36,
40,124,148,156,141,195,165,139,70,81,131,133,60,0,0,0,0,19,62,174,212,253,229,
171,68,19,4,8,0,15,23,51,152,236,225,161,107,53,19,0,0,0,0,0,12,109,88,91,93,
91,104,101,101,109,91,96,99,88,91,80,96,101,106,93,106,91,112,96,99,88,96,96,
104,91,96,93,91,104,96,104,114,96,104,112,99,91,91,99,106,93,93,88,96,96,78,93,
86,104,99,99,104,93,106,101,99,99,101,101,88,101,96,101,109,106,106,112,109,
93,99,104,106,96,91,106,91,99,109,96,80,101,99,83,57,73,104,151,156,148,174,
169,114,39,26,52,33,60,117,96,75,106,125,135,138,127,180,187,153,46,0,0,0,0,0,
49,133,253,255,255,203,93,31,0,15,0,20,20,65,177,234,216,193,180,104,33,0,0,0,
0,0,138,199,149,170,163,135,99,117,106,106,39,67,248,149,95,127,92,103,85,110,
78,95,74,106,110,117,95,127,88,113,88,106,113,99,103,124,99,71,103,106,99,88,
78,117,103,71,99,117,113,120,92,92,99,103,95,85,110,110,103,103,92,113,85,99,
110,117,113,95,124,124,99,110,92,85,95,78,103,110,85,99,124,78,88,85,117,81,60,
49,42,39,117,191,220,159,209,231,127,39,21,10,14,35,46,10,10,35,39,92,181,245,
252,227,177,60,0,0,0,0,0,31,120,238,213,170,167,106,0,0,0,0,14,10,42,142,124,
99,195,241,202,46,0,0,14,0,192,120,169,132,31,20,69,23,69,80,103,71,109,126,
178,120,86,103,40,135,103,80,43,97,100,103,94,109,92,92,97,94,77,89,97,106,77,
106,86,115,83,103,106,117,71,80,109,97,89,94,80,100,100,97,83,94,103,103,89,103,
86,103,94,103,115,112,94,94,109,100,100,94,89,97,80,97,103,94,94,97,94,94,94,
100,83,80,77,60,57,57,106,181,212,195,215,253,218,123,34,17,5,46,60,46,34,14,
0,0,83,152,192,238,238,175,74,25,5,0,0,0,37,117,166,112,92,109,57,0,0,25,2,14,
25,66,74,57,92,146,207,163,66,5,51,0,71,73,79,79,76,81,81,63,63,73,81,81,60,71,
84,92,89,79,92,71,76,87,76,65,79,76,71,60,81,76,84,84,81,71,89,81,68,84,87,87,
81,84,81,102,68,65,71,65,87,79,76,76,100,79,71,63,113,68,92,76,73,65,73,63,89,
76,81,73,97,79,94,71,105,97,81,68,65,63,73,63,71,71,73,84,92,73,79,52,76,55,60,
129,155,192,229,253,245,192,110,42,15,18,47,108,65,13,0,0,26,44,118,192,229,
234,150,73,0,0,0,5,10,31,84,97,63,68,65,36,7,18,31,34,18,47,94,102,60,60,92,166,
176,108,73,55,67,59,67,77,69,69,61,59,64,69,74,74,90,90,90,72,80,64,77,80,87,
67,72,69,74,56,77,80,80,85,87,95,64,85,92,74,90,80,87,87,74,82,85,74,80,77,61,
72,59,80,69,64,67,85,80,77,90,85,90,74,59,80,95,59,59,67,64,51,82,74,67,74,72,
100,82,80,80,87,74,80,85,74,80,67,77,95,92,85,90,59,46,59,131,183,242,253,253,
224,170,69,18,0,36,56,121,98,33,0,0,0,25,90,198,232,216,134,20,0,2,0,0,0,30,123,
87,59,87,98,15,5,28,12,15,23,64,111,149,103,82,105,142,178,98,77,72,63,80,105,
72,89,66,72,63,75,77,69,69,91,89,77,89,75,94,63,91,66,77,75,86,86,75,77,100,
86,94,91,83,72,75,69,91,86,83,91,77,75,77,69,83,80,75,89,100,91,119,114,72,72,
89,80,52,55,89,72,75,72,83,83,61,75,91,69,91,83,100,61,105,86,86,80,72,75,80,
66,102,91,80,86,119,89,108,97,119,75,27,11,52,69,122,186,253,241,205,125,36,0,
0,25,80,136,111,58,5,0,0,0,47,164,250,230,91,11,0,0,0,0,0,75,141,164,208,194,
89,19,11,0,2,2,0,58,150,169,164,77,80,139,203,186,74,62,74,84,77,91,70,91,79,
74,79,84,98,94,108,115,94,94,91,89,86,96,101,98,94,91,101,98,98,94,91,94,106,
91,77,89,98,79,70,94,86,94,89,89,79,86,84,89,74,89,103,84,79,96,101,84,91,62,
91,91,79,98,74,70,91,101,103,91,79,89,91,89,91,111,103,111,91,72,79,74,84,82,
101,89,86,91,123,125,111,84,67,16,0,0,36,84,173,195,190,171,55,16,7,24,43,89,
137,142,67,9,0,0,16,98,197,253,224,120,48,0,0,0,0,0,82,183,255,255,207,84,16,
0,9,4,0,2,43,89,144,137,67,65,238,255,88,71,82,75,93,82,88,84,100,88,88,104,
97,86,91,95,106,100,88,88,113,106,88,84,82,82,60,64,95,93,82,73,91,97,88,102,
84,95,82,84,82,95,68,84,75,93,82,93,84,97,97,95,93,95,91,95,86,77,77,75,91,104,
100,102,106,104,91,95,100,84,93,88,93,86,82,73,88,86,100,80,95,91,80,91,108,
115,93,108,115,106,80,20,0,0,0,33,115,155,186,202,137,46,24,20,46,60,140,195,
164,64,4,0,0,15,93,193,253,217,155,55,0,0,0,0,24,97,191,251,255,200,93,20,26,
22,28,31,22,28,80,146,111,64,184,253,31,45,26,42,26,58,18,21,63,101,95,101,114,
98,77,79,103,93,125,87,90,79,71,66,82,79,98,77,101,74,85,74,69,82,61,66,63,71,
87,117,77,77,71,85,98,93,101,114,93,98,63,85,71,69,93,90,98,109,95,74,85,74,71,
77,82,98,114,98,87,93,77,82,98,77,82,66,61,87,82,90,85,79,61,93,111,103,114,
135,119,141,114,98,7,0,0,0,29,87,183,253,186,82,34,26,13,0,66,157,234,167,85,
0,0,10,5,103,237,207,173,111,42,0,0,0,0,0,106,189,255,245,170,50,0,0,13,26,15,
0,15,69,149,135,98,191,119,95,127,119,122,84,117,95,95,111,103,100,114,98,100,
117,106,92,98,108,92,100,103,108,87,87,95,95,103,89,111,111,95,81,95,92,87,95,
108,92,119,114,95,95,119,103,103,108,89,98,76,73,106,106,106,106,100,108,92,111,
125,106,100,103,122,122,95,103,119,108,103,111,114,103,81,100,119,98,98,108,
108,100,108,106,114,114,141,133,157,138,182,163,70,0,0,0,0,16,100,206,253,166,
70,32,0,13,54,122,190,223,196,62,40,27,32,87,182,166,87,81,130,46,0,0,16,13,38,
114,185,206,176,133,70,24,19,40,21,0,0,2,73,160,21,92,95,111,119,95,89,92,111,
95,125,111,106,70,84,108,87,87,119,98,95,89,114,108,125,136,117,108,108,108,
117,111,98,114,100,108,106,103,103,95,87,108,100,100,114,70,100,133,127,122,
84,73,114,100,130,111,108,114,114,108,111,119,133,100,130,106,87,95,89,89,111,
141,130,125,127,108,141,108,122,108,114,100,127,76,133,119,117,106,111,119,141,
155,193,168,163,51,0,0,10,0,21,87,253,225,136,78,40,5,13,29,133,182,242,171,
43,0,0,40,130,147,49,13,78,103,51,0,0,2,0,0,98,87,100,130,147,106,46,10,49,10,
5,0,21,87,8,0,107,104,92,104,144,126,114,141,120,89,104,86,98,104,89,92,101,
101,98,83,110,110,104,107,104,107,114,98,80,92,107,104,92,83,101,101,89,104,
98,114,89,107,107,129,86,98,101,110,98,104,95,95,101,98,101,86,98,117,126,101,
98,98,95,83,107,92,123,101,126,104,110,101,120,98,117,126,83,80,86,80,89,89,114,
98,107,98,132,129,144,157,221,237,184,86,9,0,0,0,3,49,188,252,212,126,30,6,15,
0,12,83,206,234,141,15,0,21,83,126,117,30,36,77,101,15,0,0,0,0,33,67,61,49,117,
147,138,64,0,0,0,0,0,0,0,0,107,74,48,69,115,110,115,127,117,81,69,125,143,86,
63,66,61,86,69,51,81,102,97,104,66,104,110,86,69,104,92,89,92,94,89,71,81,89,
94,79,76,71,71,81,79,74,81,86,89,69,92,66,86,104,81,74,97,102,89,84,86,81,99,
84,76,81,99,79,84,89,97,86,84,69,97,92,97,76,110,81,86,79,110,84,89,94,102,102,
135,158,181,212,227,163,84,0,0,0,10,35,89,168,253,199,94,23,40,0,0,15,153,230,
243,148,40,25,33,63,122,112,51,48,125,130,66,7,10,20,51,117,150,71,48,81,112,
79,51,15,0,0,0,0,0,0,41,47,63,50,77,69,80,63,86,89,69,61,80,55,80,69,47,69,66,
69,75,75,75,77,61,75,58,61,69,69,72,52,86,89,89,61,69,94,77,86,55,77,72,69,50,
77,75,44,66,72,77,50,61,69,69,72,63,80,80,75,72,72,89,77,91,63,91,83,77,77,77,
69,77,72,61,80,77,72,66,66,63,55,89,72,83,89,97,80,105,114,172,166,211,208,166,
30,0,0,19,25,38,94,216,230,158,44,11,0,0,0,75,180,253,228,119,19,8,13,63,108,
136,105,152,191,108,22,16,5,38,80,122,116,66,33,55,77,133,108,63,50,22,19,0,0
];

function lbp8(I, threshold) {
    var m = I.m;
    var n = I.n;
    var J = new Matrix(m,n);
    var i, j;
    var p = [[-1,-1], [-1,0], [-1,1],
             [0,-1], [0,1],
             [1,-1], [1,0], [1,1]];
    var w = [1, 2, 4, 8, 16, 32, 64, 128];
    for (i = 1; i < m-1; ++i) {
        for (j = 1; j < n-1; ++j) {
            var c = I.data[i*n+j];
            var v = 0;
            for (k = 0; k < p.length; ++k) {
                v += ((c - I.data[(i+p[k][0])*n + (j+p[k][1])]) > threshold)*w[k];
            }
            J.data[i*n+j] = v;
        }
    }
    return J;
}

function lbp(I, radius, num, threshold) {
    var m = I.m;
    var n = I.n;
    var J = new Matrix(m,n);
    var i, j, k;
    var r = new Array(num);
    var c = new Array(num);
    var w = new Array(num);
    for (k = 0; k < num; ++k) {
        r[k] = Math.round(-radius*Math.sin(2*Math.PI*k/num));
        c[k] = Math.round(radius*Math.cos(2*Math.PI*k/num));
        w[k] = (1 << k);
    }
    for (i = radius; i < m-radius; ++i) {
        for (j = radius; j < n-radius; ++j) {
            var p = I.data[i*n+j];
            var v = new Array(num);
            for (k = 0; k < w.length; ++k) {
                v[k] = Math.abs(p - I.data[(i+r[k])*n + (j+c[k])]) > threshold;
            }
            var b = 0;
            var s = 0;
            for (k = 0; k < v.length; ++k) {
                s += v[k];
                b += v[k]*w[k];
            }
            J.data[i*n+j] = s*255/v.length;
        }
    }
    return J;
}

function update() {
    document.getElementById("radiusOutput").value = document.getElementById("radius").value;
    document.getElementById("thresholdOutput").value = document.getElementById("threshold").value;
    J = lbp(gImage, document.getElementById("radius").value, 8, document.getElementById("threshold").value);
    drawImage(J, document.getElementById("canvasLBP"));
}

drawImage(gImage, document.getElementById("canvasImage"));
update();
</script>
</body>
</html>
