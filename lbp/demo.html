<!DOCTYPE html>
<html>
<body>
<h1>Local Binary Pattern</h1>
<canvas id="canvasImage"></canvas>
<canvas id="canvasLBP"></canvas>
<div>
<label for="radius">Radius</label>
<input id="radius" type="range" min="1" max="32" value="4" oninput="update()" />
<output for="radius" id="radiusOutput"></output>
</div>
<div>
<label for="num">Number</label>
<input id="num" type="range" min="1" max="32" value="16" oninput="update()" />
<output for="num" id="numOutput"></output>
</div>
<div>
<label for="threshold">Threshold</label>
<input id="threshold" type="range" min="1" max="255" value="64" oninput="update()" />
<output for="threshold" id="thresholdOutput"></output>
</div>

<script>
function Matrix(numRows, numCols) {
    this.m = numRows;
    this.n = numCols;
    this.data = new Array(numRows*numCols);
    var i;
    for (i = 0; i < numRows*numCols; ++i) this.data[i] = 0;
}

function drawImage(I, canvas) {
    canvas.width = I.n;
    canvas.height = I.m;
    var ctx = canvas.getContext("2d");
    var imageData = ctx.createImageData(I.n, I.m);
    var i, j;
    for (i = 0; i < I.m; ++i) {
        for (j = 0; j < I.n; ++j) {
            imageData.data[4*(i*I.n + j)] = I.data[i*I.n + j];
            imageData.data[4*(i*I.n + j) + 1] = I.data[i*I.n + j];
            imageData.data[4*(i*I.n + j) + 2] = I.data[i*I.n + j];
            imageData.data[4*(i*I.n + j) + 3] = 255;
        }
    }
    ctx.putImageData(imageData, 0, 0);
}

// example image
var gImage = new Matrix(40,144);
gImage.data = [
43,54,66,52,54,54,57,45,43,52,43,34,57,70,70,41,73,63,54,54,54,50,61,52,61,59,
47,47,57,61,47,43,66,47,57,36,63,59,77,36,41,52,57,38,52,63,66,52,54,61,59,59,
52,61,45,47,38,45,52,43,36,52,59,50,43,54,43,68,41,61,54,70,41,43,41,61,38,59,
47,61,38,45,50,54,57,66,73,100,121,155,171,185,132,70,0,29,68,130,91,57,2,15,
13,68,153,219,221,201,82,27,0,11,0,0,0,13,6,77,146,253,233,228,194,173,84,25,
6,22,34,41,34,57,91,178,201,191,148,164,141,107,63,52,4,36,37,65,63,70,61,53,
65,51,61,39,44,37,72,61,56,46,58,63,58,58,65,65,44,49,68,56,53,58,51,65,51,56,
58,68,53,46,63,63,49,49,70,72,58,49,61,63,56,56,58,49,56,56,39,51,58,61,46,65,
53,68,68,68,51,70,72,53,53,56,63,63,58,56,49,49,44,56,56,65,61,56,46,58,56,75,
46,70,61,98,117,147,171,194,133,70,4,30,58,122,96,49,9,23,21,65,161,220,246,
199,82,39,0,16,0,0,0,0,7,75,159,246,253,248,204,178,103,46,18,35,28,18,16,44,
86,183,206,192,152,180,133,112,63,63,4,51,68,98,81,68,63,86,63,59,86,78,63,71,
78,91,76,66,71,61,86,63,66,66,88,71,63,61,78,61,66,66,71,73,71,81,66,81,66,76,
61,78,81,68,68,71,78,76,68,81,73,68,59,54,66,73,59,66,71,71,71,66,61,61,56,61,
81,78,56,78,68,76,59,76,56,68,56,49,68,81,54,63,61,71,73,78,59,86,91,105,103,
162,177,211,179,115,17,9,29,147,182,110,39,17,0,31,73,152,201,253,184,118,22,
0,4,0,7,0,0,14,41,172,226,243,233,241,209,127,17,0,2,19,0,19,9,83,135,115,63,
125,177,199,105,44,19,19,87,105,65,87,87,67,77,77,102,67,90,92,82,67,80,80,102,
85,90,102,82,85,87,85,90,90,97,75,85,77,87,75,82,75,75,95,85,77,72,85,80,80,70,
92,97,87,85,87,100,97,92,92,87,87,72,75,95,82,57,77,92,85,65,80,77,85,80,67,70,
72,82,85,80,102,92,95,77,90,85,100,80,85,80,90,67,75,67,62,97,137,170,200,170,
130,17,0,17,115,183,208,100,45,7,0,22,70,122,198,253,238,147,82,7,0,7,0,0,5,25,
82,137,190,208,230,253,225,115,17,2,0,2,17,0,15,80,120,115,142,213,250,193,115,
112,32,97,85,80,25,107,92,97,100,82,67,75,60,85,90,67,75,97,90,92,82,97,85,85,
80,97,77,82,87,85,92,80,80,70,92,87,92,92,85,80,87,92,97,112,105,90,100,97,90,
122,97,90,95,102,75,72,100,97,82,100,85,90,65,72,87,92,90,87,87,95,87,100,80,
90,77,90,75,90,77,75,67,92,102,85,95,82,85,60,80,62,87,142,198,188,163,67,0,0,
25,112,228,175,85,22,35,0,5,32,127,198,253,243,213,92,50,22,0,0,0,0,0,42,120,
203,235,255,255,200,62,0,0,0,5,0,0,22,127,183,230,255,255,255,218,193,72,71,87,
100,100,87,73,73,76,91,69,89,103,96,78,98,114,105,91,98,87,105,105,96,103,96,
71,80,69,76,71,69,71,82,96,78,85,94,89,89,94,94,87,87,82,91,89,91,82,96,98,105,
105,87,73,89,87,80,78,94,94,62,73,85,94,89,89,85,96,96,87,87,103,91,78,87,85,
69,87,82,73,87,107,96,80,82,96,73,76,47,67,62,123,136,174,116,53,0,0,65,177,
195,136,65,26,0,0,20,51,116,188,253,239,188,127,78,26,0,2,8,6,0,26,112,163,208,
255,230,152,62,13,17,22,0,2,17,71,107,139,186,246,255,253,230,154,87,99,89,101,
78,89,78,89,76,91,83,87,81,78,95,85,103,93,93,97,89,95,93,97,83,83,85,68,87,85,
81,72,91,72,78,76,95,89,83,87,91,83,72,81,97,89,93,89,81,87,83,91,81,76,93,95,
78,81,68,93,74,89,89,89,81,95,74,74,76,95,83,78,76,91,74,70,83,93,93,103,76,97,
93,87,85,103,72,66,39,39,16,31,116,191,201,135,45,0,6,93,180,184,126,49,18,0,0,
0,31,93,187,224,253,241,182,97,18,0,0,0,0,8,33,81,101,184,228,222,143,58,4,2,2,
2,20,35,27,49,97,164,228,247,234,228,72,97,119,115,88,97,119,104,61,61,90,85,
42,56,85,74,90,101,83,88,83,85,88,83,76,85,88,65,90,92,88,74,99,83,108,92,83,
63,88,74,92,79,90,90,92,88,79,88,88,85,99,99,81,76,81,83,83,67,58,72,104,92,88,
88,101,81,94,97,74,58,76,79,85,74,79,85,99,101,88,97,88,106,94,104,67,88,74,70,
54,40,0,0,33,137,196,208,119,36,0,13,104,185,171,97,36,24,15,15,0,36,97,174,
228,253,246,169,88,33,11,0,0,0,0,0,9,83,183,237,255,189,108,52,29,31,15,27,6,6,
4,63,162,203,180,242,118,98,98,114,29,87,96,100,33,96,94,96,78,136,143,152,76,
91,73,105,94,65,89,71,116,80,87,105,96,98,94,107,89,91,91,118,80,73,91,85,82,
82,100,98,96,87,98,96,98,85,82,91,100,103,91,98,82,78,89,94,91,105,98,98,96,91,
87,103,87,91,78,103,82,91,87,103,103,107,89,98,94,89,105,100,109,103,89,94,71,
31,0,0,0,29,141,192,183,107,26,0,40,132,213,201,96,33,11,20,2,8,20,78,168,239,
253,239,165,69,4,0,8,0,0,0,0,13,78,181,255,255,233,174,67,31,20,20,8,6,0,20,65,
130,103,201,105,99,109,109,81,85,99,89,93,77,81,89,71,79,79,85,95,91,99,95,93,
85,87,87,85,79,85,85,75,79,79,83,91,95,101,89,81,93,87,89,95,81,103,93,71,73,
85,75,91,79,77,85,87,85,99,93,77,93,95,91,87,79,93,93,87,95,105,93,79,83,89,89,
71,79,89,93,79,87,105,99,87,95,93,89,95,89,89,85,77,56,0,0,0,0,48,127,178,138,
48,22,42,65,154,227,199,125,40,26,0,2,0,22,71,148,217,249,253,178,99,42,22,2,2,
0,0,12,42,107,207,255,255,255,170,93,40,36,24,14,26,12,12,50,56,109,98,102,90,
88,106,100,96,84,90,104,90,84,88,102,80,84,114,104,110,108,106,92,96,110,98,94,
98,96,110,100,98,112,106,106,106,108,100,100,88,96,108,102,98,106,90,104,94,98,
94,102,94,92,94,108,96,104,96,100,112,90,84,112,96,90,98,114,100,96,94,98,100,
112,86,102,96,100,86,102,104,98,98,98,98,94,86,112,102,102,100,80,6,0,0,0,6,64,
129,141,50,34,24,42,76,195,235,187,76,20,2,16,0,8,10,66,157,219,235,253,181,
94,0,0,0,0,0,0,12,46,110,193,255,255,255,193,84,36,12,2,2,0,2,24,10,42,76,54,
44,54,78,82,83,64,85,93,89,80,83,87,91,76,74,83,89,91,76,85,97,91,89,85,93,99,
83,82,95,89,82,91,76,83,83,89,85,83,93,93,93,91,87,87,85,91,99,101,89,89,83,87,
91,89,87,97,85,89,95,89,78,78,93,74,91,89,93,82,87,85,87,87,93,83,82,74,83,76,
74,76,87,80,68,76,85,97,91,82,33,0,0,0,17,39,56,95,80,29,11,13,21,85,173,201,
162,68,46,25,0,0,5,35,64,132,195,253,242,189,74,21,0,0,0,17,9,23,64,125,173,
232,255,255,167,82,19,1,0,0,1,27,0,17,95,98,61,63,134,108,132,183,138,138,134,
153,70,83,78,66,85,81,91,81,66,74,83,81,72,78,91,89,63,81,87,81,89,89,81,85,83,
83,78,76,85,74,87,81,72,74,76,74,89,89,87,81,85,78,76,89,87,83,68,87,87,74,68,
87,66,66,72,81,72,72,70,61,93,93,87,83,83,83,76,87,83,72,66,66,66,66,74,87,91,
93,72,21,0,0,6,8,0,40,38,29,12,4,6,42,85,172,200,136,53,14,0,0,8,4,21,44,140,
215,251,253,183,98,25,0,0,4,0,4,25,46,72,134,234,255,255,172,76,17,2,0,0,4,0,0,
99,97,85,97,82,101,71,85,75,85,80,87,78,82,92,78,73,82,73,75,75,80,78,94,82,104,
101,99,97,115,87,108,101,104,106,92,87,89,82,61,85,104,82,85,85,104,99,68,85,
99,78,94,92,94,82,87,97,106,94,97,61,89,73,94,82,82,78,85,59,68,54,66,75,104,
99,106,111,130,120,101,113,111,108,97,82,82,73,85,94,115,144,108,49,28,9,4,0,18,
40,37,16,28,26,35,75,113,224,227,151,54,7,0,0,0,0,23,87,170,220,253,239,201,
120,63,30,11,0,9,42,44,47,85,158,229,255,255,220,132,56,11,4,2,28,28,104,104,
130,112,78,96,96,91,80,88,112,73,99,101,114,99,112,106,104,109,80,96,96,91,125,
112,106,112,88,99,96,101,96,101,106,99,93,104,109,104,88,101,96,101,101,104,
91,96,96,104,109,117,112,86,101,101,99,112,96,99,112,104,88,96,86,96,83,96,112,
86,99,112,109,114,101,104,127,117,99,125,106,127,93,112,93,75,75,88,83,99,135,
159,182,167,93,31,13,0,20,36,31,20,41,65,46,70,164,253,234,135,28,0,0,0,0,0,7,
44,122,206,250,232,245,213,101,10,0,0,7,33,26,46,57,127,206,255,255,255,206,
104,2,2,0,0,102,104,117,107,97,92,84,71,63,69,79,48,71,86,86,79,63,69,81,79,89,
79,99,86,89,81,92,94,92,86,99,76,92,102,86,79,94,79,110,79,89,86,97,81,81,74,
86,61,89,102,86,89,92,97,92,86,92,94,89,86,56,63,48,56,56,61,63,63,79,89,92,92,
92,92,94,89,94,79,97,89,86,84,81,76,74,63,48,53,43,46,86,143,202,214,173,94,12,
0,15,25,48,25,38,46,43,7,40,138,253,214,127,46,0,0,0,0,2,0,30,97,181,240,245,
250,194,89,5,0,0,0,5,0,38,35,99,202,255,255,255,202,110,53,12,0,58,50,63,84,71,
71,42,60,65,87,50,60,39,50,44,58,47,50,60,52,73,65,79,60,81,71,68,76,60,58,58,
60,79,68,63,73,73,79,68,71,76,47,58,55,63,50,52,71,65,60,65,63,71,63,68,58,65,
71,65,73,60,65,44,68,65,60,65,68,65,50,44,63,58,68,79,71,60,60,71,87,71,71,68,
76,47,44,44,47,15,0,15,81,147,232,253,189,108,26,36,23,89,105,58,47,18,0,0,60,
158,226,234,158,110,34,0,0,0,0,0,0,87,189,253,255,255,226,113,23,0,0,2,0,0,7,31,
123,239,255,255,255,239,163,110,39,108,127,106,111,70,33,74,72,103,101,82,91,
94,91,96,98,72,70,77,79,82,94,94,96,77,82,96,94,72,89,72,89,89,89,94,84,91,96,
91,98,86,79,79,91,77,74,86,60,82,89,84,86,94,89,84,89,74,86,77,79,74,77,72,89,
70,74,72,77,82,77,84,79,96,86,94,74,84,79,101,84,86,91,79,94,74,77,62,38,16,0,
0,0,86,188,251,253,222,147,118,115,156,181,132,65,24,2,0,0,60,137,207,229,210,
123,28,16,7,4,0,0,33,106,190,255,255,255,222,161,36,26,24,7,9,16,16,82,156,219,
253,255,255,255,224,154,0,0,0,0,123,99,121,110,103,110,107,125,72,61,72,88,74,
63,57,68,92,68,77,79,74,79,61,72,83,77,66,81,81,81,81,81,68,81,77,83,57,72,72,
66,55,83,63,79,77,88,74,63,68,77,63,63,66,55,72,70,81,96,79,81,68,70,72,70,70,
77,70,72,72,74,90,61,61,63,74,57,66,66,57,63,85,61,59,61,22,0,0,0,4,83,187,253,
244,174,121,90,127,169,191,141,61,30,0,0,19,79,147,213,248,215,136,44,28,15,13,
4,15,17,114,202,255,255,255,213,136,68,22,24,4,0,35,63,79,112,174,213,248,255,
253,207,95,102,95,112,92,82,85,90,97,92,87,104,85,80,80,95,95,95,90,85,75,85,
82,87,104,107,95,104,99,104,99,104,87,80,104,82,97,99,109,109,92,97,107,92,85,
80,87,92,85,87,90,90,107,97,104,92,92,90,102,97,95,87,95,90,99,99,60,73,95,99,
95,82,114,104,90,102,107,92,87,97,97,92,78,99,90,82,75,48,58,14,0,0,0,24,95,192,
236,199,107,51,48,112,175,209,153,92,24,7,0,0,26,121,226,253,241,136,36,26,21,
24,0,0,21,82,190,246,251,204,168,131,46,14,14,24,29,36,19,41,51,70,141,236,234,
197,56,47,68,63,47,68,52,63,54,61,66,71,49,66,75,68,52,42,49,49,63,54,59,63,63,
52,66,66,71,42,63,73,71,78,61,63,61,59,61,61,54,54,42,52,66,56,66,61,66,47,59,
78,68,61,63,71,47,42,44,54,75,61,63,68,68,61,49,56,68,61,49,52,59,56,59,56,68,
61,44,40,49,63,59,49,68,71,82,73,61,28,2,2,0,0,0,66,144,179,115,37,18,28,63,134,
191,175,87,23,0,0,0,26,125,201,253,215,97,23,11,0,0,0,0,4,40,139,198,146,99,97,
89,35,40,26,73,33,26,0,0,0,30,104,196,137,115,110,110,115,103,95,91,108,93,86,
83,78,76,83,71,73,98,93,93,91,68,78,76,63,95,113,100,98,93,113,98,95,91,98,88,
93,105,108,98,105,86,91,95,98,95,91,88,110,83,88,95,103,88,81,83,103,103,93,105,
103,103,103,120,123,110,120,118,110,105,110,103,100,83,93,71,83,91,81,88,78,93,
86,98,86,98,98,123,110,105,83,78,46,7,0,0,24,88,187,199,125,56,49,36,63,123,
201,169,71,22,19,0,0,46,105,206,253,243,147,83,36,0,0,0,0,4,54,132,184,150,100,
113,125,61,39,68,61,36,7,0,0,7,61,123,174,98,103,98,82,113,111,106,120,108,111,
98,106,106,113,91,115,98,108,108,111,98,108,101,108,106,98,86,98,108,108,118,
115,91,106,103,96,98,98,115,96,101,118,111,101,118,120,115,130,106,103,108,103,
94,98,108,111,103,115,106,106,106,113,118,118,106,115,130,106,96,101,106,96,101,
101,111,106,91,96,96,98,101,96,106,94,108,111,123,125,127,123,115,94,55,16,0,0,
48,137,210,207,91,38,24,19,55,120,168,127,65,21,0,0,0,31,82,183,248,253,195,
108,28,21,19,0,0,24,33,82,168,185,217,212,130,24,28,24,16,4,0,0,0,0,41,94,65,
92,83,67,79,95,72,72,95,97,90,88,60,72,65,55,83,74,79,72,74,65,85,83,83,85,97,
81,72,81,90,74,72,62,81,74,72,67,76,72,92,81,95,90,92,72,97,88,90,79,88,60,85,
76,81,69,83,76,72,67,92,85,104,76,92,81,90,76,76,88,79,88,55,72,72,76,79,76,95,
74,79,69,76,72,69,62,76,90,109,118,132,118,90,44,2,13,6,39,125,169,169,111,90,
58,60,65,90,130,123,37,0,0,0,0,0,53,167,239,253,223,146,58,4,0,0,0,0,16,72,151,
255,255,225,74,18,6,2,0,0,16,2,0,0,6,82,97,91,104,88,97,95,102,77,82,86,82,68,
86,77,88,84,93,93,97,82,91,84,102,86,88,73,91,84,102,84,88,93,86,73,86,102,100,
82,97,86,86,64,93,100,95,84,91,68,82,80,88,84,95,88,108,71,71,82,86,84,93,95,
117,88,93,82,93,80,84,86,88,86,77,80,82,93,88,82,91,88,93,75,97,71,60,80,93,100,
108,137,142,140,95,53,24,0,0,28,117,180,200,188,164,142,115,51,86,117,128,71,
17,0,0,0,20,84,160,231,253,237,164,46,0,0,6,0,6,0,48,160,237,255,166,71,11,6,0,
0,0,11,0,0,0,88,90,81,92,79,88,70,66,83,75,73,62,75,79,77,64,60,70,81,75,83,90,
90,88,73,81,85,92,70,64,70,77,70,73,75,66,79,77,92,68,75,70,77,83,88,92,96,85,
70,79,58,81,92,85,77,90,79,79,70,77,105,96,83,94,85,70,75,79,79,64,68,73,85,75,
88,83,85,79,96,94,96,81,94,79,79,58,77,75,68,100,124,113,116,126,120,42,19,0,36,
40,124,148,156,141,195,165,139,70,81,131,133,60,0,0,0,0,19,62,174,212,253,229,
171,68,19,4,8,0,15,23,51,152,236,225,161,107,53,19,0,0,0,0,0,12,109,88,91,93,
91,104,101,101,109,91,96,99,88,91,80,96,101,106,93,106,91,112,96,99,88,96,96,
104,91,96,93,91,104,96,104,114,96,104,112,99,91,91,99,106,93,93,88,96,96,78,93,
86,104,99,99,104,93,106,101,99,99,101,101,88,101,96,101,109,106,106,112,109,
93,99,104,106,96,91,106,91,99,109,96,80,101,99,83,57,73,104,151,156,148,174,
169,114,39,26,52,33,60,117,96,75,106,125,135,138,127,180,187,153,46,0,0,0,0,0,
49,133,253,255,255,203,93,31,0,15,0,20,20,65,177,234,216,193,180,104,33,0,0,0,
0,0,138,199,149,170,163,135,99,117,106,106,39,67,248,149,95,127,92,103,85,110,
78,95,74,106,110,117,95,127,88,113,88,106,113,99,103,124,99,71,103,106,99,88,
78,117,103,71,99,117,113,120,92,92,99,103,95,85,110,110,103,103,92,113,85,99,
110,117,113,95,124,124,99,110,92,85,95,78,103,110,85,99,124,78,88,85,117,81,60,
49,42,39,117,191,220,159,209,231,127,39,21,10,14,35,46,10,10,35,39,92,181,245,
252,227,177,60,0,0,0,0,0,31,120,238,213,170,167,106,0,0,0,0,14,10,42,142,124,
99,195,241,202,46,0,0,14,0,192,120,169,132,31,20,69,23,69,80,103,71,109,126,
178,120,86,103,40,135,103,80,43,97,100,103,94,109,92,92,97,94,77,89,97,106,77,
106,86,115,83,103,106,117,71,80,109,97,89,94,80,100,100,97,83,94,103,103,89,103,
86,103,94,103,115,112,94,94,109,100,100,94,89,97,80,97,103,94,94,97,94,94,94,
100,83,80,77,60,57,57,106,181,212,195,215,253,218,123,34,17,5,46,60,46,34,14,
0,0,83,152,192,238,238,175,74,25,5,0,0,0,37,117,166,112,92,109,57,0,0,25,2,14,
25,66,74,57,92,146,207,163,66,5,51,0,71,73,79,79,76,81,81,63,63,73,81,81,60,71,
84,92,89,79,92,71,76,87,76,65,79,76,71,60,81,76,84,84,81,71,89,81,68,84,87,87,
81,84,81,102,68,65,71,65,87,79,76,76,100,79,71,63,113,68,92,76,73,65,73,63,89,
76,81,73,97,79,94,71,105,97,81,68,65,63,73,63,71,71,73,84,92,73,79,52,76,55,60,
129,155,192,229,253,245,192,110,42,15,18,47,108,65,13,0,0,26,44,118,192,229,
234,150,73,0,0,0,5,10,31,84,97,63,68,65,36,7,18,31,34,18,47,94,102,60,60,92,166,
176,108,73,55,67,59,67,77,69,69,61,59,64,69,74,74,90,90,90,72,80,64,77,80,87,
67,72,69,74,56,77,80,80,85,87,95,64,85,92,74,90,80,87,87,74,82,85,74,80,77,61,
72,59,80,69,64,67,85,80,77,90,85,90,74,59,80,95,59,59,67,64,51,82,74,67,74,72,
100,82,80,80,87,74,80,85,74,80,67,77,95,92,85,90,59,46,59,131,183,242,253,253,
224,170,69,18,0,36,56,121,98,33,0,0,0,25,90,198,232,216,134,20,0,2,0,0,0,30,123,
87,59,87,98,15,5,28,12,15,23,64,111,149,103,82,105,142,178,98,77,72,63,80,105,
72,89,66,72,63,75,77,69,69,91,89,77,89,75,94,63,91,66,77,75,86,86,75,77,100,
86,94,91,83,72,75,69,91,86,83,91,77,75,77,69,83,80,75,89,100,91,119,114,72,72,
89,80,52,55,89,72,75,72,83,83,61,75,91,69,91,83,100,61,105,86,86,80,72,75,80,
66,102,91,80,86,119,89,108,97,119,75,27,11,52,69,122,186,253,241,205,125,36,0,
0,25,80,136,111,58,5,0,0,0,47,164,250,230,91,11,0,0,0,0,0,75,141,164,208,194,
89,19,11,0,2,2,0,58,150,169,164,77,80,139,203,186,74,62,74,84,77,91,70,91,79,
74,79,84,98,94,108,115,94,94,91,89,86,96,101,98,94,91,101,98,98,94,91,94,106,
91,77,89,98,79,70,94,86,94,89,89,79,86,84,89,74,89,103,84,79,96,101,84,91,62,
91,91,79,98,74,70,91,101,103,91,79,89,91,89,91,111,103,111,91,72,79,74,84,82,
101,89,86,91,123,125,111,84,67,16,0,0,36,84,173,195,190,171,55,16,7,24,43,89,
137,142,67,9,0,0,16,98,197,253,224,120,48,0,0,0,0,0,82,183,255,255,207,84,16,
0,9,4,0,2,43,89,144,137,67,65,238,255,88,71,82,75,93,82,88,84,100,88,88,104,
97,86,91,95,106,100,88,88,113,106,88,84,82,82,60,64,95,93,82,73,91,97,88,102,
84,95,82,84,82,95,68,84,75,93,82,93,84,97,97,95,93,95,91,95,86,77,77,75,91,104,
100,102,106,104,91,95,100,84,93,88,93,86,82,73,88,86,100,80,95,91,80,91,108,
115,93,108,115,106,80,20,0,0,0,33,115,155,186,202,137,46,24,20,46,60,140,195,
164,64,4,0,0,15,93,193,253,217,155,55,0,0,0,0,24,97,191,251,255,200,93,20,26,
22,28,31,22,28,80,146,111,64,184,253,31,45,26,42,26,58,18,21,63,101,95,101,114,
98,77,79,103,93,125,87,90,79,71,66,82,79,98,77,101,74,85,74,69,82,61,66,63,71,
87,117,77,77,71,85,98,93,101,114,93,98,63,85,71,69,93,90,98,109,95,74,85,74,71,
77,82,98,114,98,87,93,77,82,98,77,82,66,61,87,82,90,85,79,61,93,111,103,114,
135,119,141,114,98,7,0,0,0,29,87,183,253,186,82,34,26,13,0,66,157,234,167,85,
0,0,10,5,103,237,207,173,111,42,0,0,0,0,0,106,189,255,245,170,50,0,0,13,26,15,
0,15,69,149,135,98,191,119,95,127,119,122,84,117,95,95,111,103,100,114,98,100,
117,106,92,98,108,92,100,103,108,87,87,95,95,103,89,111,111,95,81,95,92,87,95,
108,92,119,114,95,95,119,103,103,108,89,98,76,73,106,106,106,106,100,108,92,111,
125,106,100,103,122,122,95,103,119,108,103,111,114,103,81,100,119,98,98,108,
108,100,108,106,114,114,141,133,157,138,182,163,70,0,0,0,0,16,100,206,253,166,
70,32,0,13,54,122,190,223,196,62,40,27,32,87,182,166,87,81,130,46,0,0,16,13,38,
114,185,206,176,133,70,24,19,40,21,0,0,2,73,160,21,92,95,111,119,95,89,92,111,
95,125,111,106,70,84,108,87,87,119,98,95,89,114,108,125,136,117,108,108,108,
117,111,98,114,100,108,106,103,103,95,87,108,100,100,114,70,100,133,127,122,
84,73,114,100,130,111,108,114,114,108,111,119,133,100,130,106,87,95,89,89,111,
141,130,125,127,108,141,108,122,108,114,100,127,76,133,119,117,106,111,119,141,
155,193,168,163,51,0,0,10,0,21,87,253,225,136,78,40,5,13,29,133,182,242,171,
43,0,0,40,130,147,49,13,78,103,51,0,0,2,0,0,98,87,100,130,147,106,46,10,49,10,
5,0,21,87,8,0,107,104,92,104,144,126,114,141,120,89,104,86,98,104,89,92,101,
101,98,83,110,110,104,107,104,107,114,98,80,92,107,104,92,83,101,101,89,104,
98,114,89,107,107,129,86,98,101,110,98,104,95,95,101,98,101,86,98,117,126,101,
98,98,95,83,107,92,123,101,126,104,110,101,120,98,117,126,83,80,86,80,89,89,114,
98,107,98,132,129,144,157,221,237,184,86,9,0,0,0,3,49,188,252,212,126,30,6,15,
0,12,83,206,234,141,15,0,21,83,126,117,30,36,77,101,15,0,0,0,0,33,67,61,49,117,
147,138,64,0,0,0,0,0,0,0,0,107,74,48,69,115,110,115,127,117,81,69,125,143,86,
63,66,61,86,69,51,81,102,97,104,66,104,110,86,69,104,92,89,92,94,89,71,81,89,
94,79,76,71,71,81,79,74,81,86,89,69,92,66,86,104,81,74,97,102,89,84,86,81,99,
84,76,81,99,79,84,89,97,86,84,69,97,92,97,76,110,81,86,79,110,84,89,94,102,102,
135,158,181,212,227,163,84,0,0,0,10,35,89,168,253,199,94,23,40,0,0,15,153,230,
243,148,40,25,33,63,122,112,51,48,125,130,66,7,10,20,51,117,150,71,48,81,112,
79,51,15,0,0,0,0,0,0,41,47,63,50,77,69,80,63,86,89,69,61,80,55,80,69,47,69,66,
69,75,75,75,77,61,75,58,61,69,69,72,52,86,89,89,61,69,94,77,86,55,77,72,69,50,
77,75,44,66,72,77,50,61,69,69,72,63,80,80,75,72,72,89,77,91,63,91,83,77,77,77,
69,77,72,61,80,77,72,66,66,63,55,89,72,83,89,97,80,105,114,172,166,211,208,166,
30,0,0,19,25,38,94,216,230,158,44,11,0,0,0,75,180,253,228,119,19,8,13,63,108,
136,105,152,191,108,22,16,5,38,80,122,116,66,33,55,77,133,108,63,50,22,19,0,0
];
/*gImage.data=[
106,124,123,142,205,231,223,162,159,113,95,103,146,196,214,190,142,124,119,116,132,168,223,254,201,157,126,109,96,93,95,160,221,228,175,127,121,106,106,113,187,221,198,113,77,72,67,63,116,180,198,177,105,63,49,62,85,144,167,150,62,24,26,31,52,86,126,116,57,32,3,8,1,26,50,113,109,57,0,0,0,9,67,68,45,14,9,19,32,82,88,90,63,77,68,75,62,72,82,106,111,109,111,121,118,119,118,131,129,126,134,147,129,137,127,126,124,136,134,127,123,147,132,129,141,141,134,134,134,146,144,146,126,126,121,134,129,124,131,131,147,141,132,146,
106,116,137,154,207,239,230,189,164,119,121,122,161,197,242,207,152,129,124,126,147,179,237,254,222,166,141,126,111,96,104,159,237,239,189,132,126,122,106,127,205,239,202,131,97,91,83,91,121,189,215,179,122,78,74,76,99,152,187,156,71,39,39,43,59,97,139,137,69,41,26,16,13,18,68,112,116,63,0,0,0,29,76,89,34,33,19,34,36,92,101,97,64,68,68,79,76,86,101,111,114,119,126,121,136,137,144,142,137,141,141,139,136,134,152,147,144,142,142,159,136,134,137,144,147,137,139,152,146,144,146,161,154,141,132,149,149,141,141,147,144,144,129,139,,
66,55,84,173,227,221,181,127,101,80,66,116,185,242,252,194,93,72,74,84,133,183,227,254,212,126,82,76,51,66,118,185,217,181,99,70,68,64,101,143,194,175,116,63,28,32,24,55,101,177,168,126,61,38,24,30,63,133,156,101,5,7,9,13,15,78,120,76,5,1,0,1,3,9,59,95,80,3,0,5,5,11,40,17,0,0,0,5,11,36,72,49,34,24,43,57,59,64,85,99,116,112,112,101,84,110,106,106,114,120,127,127,118,126,129,118,118,129,124,122,108,120,110,127,108,126,114,124,126,112,118,114,110,106,127,126,129,127,139,118,127,127,129,124,
60,47,75,205,228,208,130,87,45,75,117,195,238,255,255,165,85,65,57,77,173,220,253,245,193,112,55,32,52,75,163,208,165,92,52,37,55,80,170,213,210,105,50,32,27,27,37,55,165,193,130,80,70,42,25,27,32,102,132,60,7,10,12,17,17,87,120,45,5,2,0,2,5,12,95,110,57,5,0,7,7,20,67,7,0,0,0,7,15,67,67,57,30,42,45,62,87,100,107,105,142,127,122,112,87,117,112,97,142,145,130,140,125,140,130,140,132,132,125,132,145,125,117,135,137,135,145,142,137,117,150,117,127,125,147,137,145,140,145,135,137,135,137,122,
111,51,114,174,245,220,92,78,49,100,185,255,255,255,204,114,62,70,62,127,193,231,206,160,147,122,81,59,65,136,231,215,106,54,57,40,76,147,247,253,174,65,40,35,43,49,92,152,253,198,87,21,49,38,27,32,89,114,119,62,8,10,13,19,81,168,133,40,5,2,0,2,5,13,98,119,57,5,0,8,8,103,106,49,0,0,0,8,24,68,95,76,62,68,87,103,125,127,133,144,147,130,133,136,136,152,155,152,149,163,149,152,157,176,166,168,157,155,168,152,152,166,157,152,152,168,163,163,136,166,149,149,138,138,160,157,157,149,174,155,147,147,168,166,
133,108,197,233,186,130,63,75,50,150,255,255,239,225,158,119,75,58,108,183,253,189,122,77,69,102,97,72,125,189,239,175,80,41,63,66,122,191,253,191,102,33,30,38,55,47,111,205,216,150,38,22,22,50,83,108,125,100,69,11,8,11,13,19,116,152,114,30,5,2,0,2,5,38,125,108,19,5,0,8,44,108,55,8,0,0,0,8,50,111,116,94,69,91,94,130,136,164,161,150,130,139,150,147,141,166,166,141,141,147,164,150,150,169,155,152,158,161,172,161,158,155,166,166,155,172,169,158,164,147,175,183,169,166,161,155,180,164,150,150,178,152,175,175,
175,184,221,138,63,86,43,43,51,232,255,255,66,80,83,54,54,43,143,247,253,112,31,31,46,69,77,54,143,192,230,109,31,34,37,57,189,238,172,69,28,28,31,34,31,43,94,146,155,63,23,23,23,25,97,178,161,54,8,11,8,11,14,20,92,71,14,8,5,2,0,2,5,54,106,34,17,5,0,8,66,66,11,8,0,0,0,8,74,89,106,80,80,94,97,109,135,155,143,123,126,132,129,117,129,146,155,138,126,129,120,138,152,146,135,126,138,155,152,140,149,149,163,146,138,140,146,140,132,132,129,152,135,143,140,132,138,126,138,135,123,132,152,149,
192,207,194,68,35,43,35,83,58,217,235,126,37,40,68,65,86,151,220,253,187,98,27,27,40,70,78,86,162,215,212,113,58,58,83,144,187,184,93,25,25,25,27,53,134,126,159,131,58,17,20,20,20,32,156,184,146,27,7,10,7,10,12,96,116,30,12,7,5,2,0,2,5,60,88,30,15,5,0,30,60,17,10,7,0,0,22,73,103,108,98,106,106,101,108,124,149,141,129,131,129,129,139,118,134,144,139,139,124,121,116,106,118,111,129,103,141,139,149,126,141,154,159,151,101,116,134,111,144,149,118,121,124,131,131,126,146,136,134,129,139,131,136,141,
255,155,71,67,58,37,37,58,109,255,255,79,62,29,29,125,146,213,251,159,58,50,46,46,54,62,58,54,54,159,197,88,67,58,54,83,58,50,46,41,41,41,46,117,180,201,167,41,33,29,33,33,33,37,130,167,75,20,12,16,12,16,20,54,88,25,20,12,8,4,0,4,8,20,20,20,25,8,0,12,12,25,16,12,0,0,0,12,83,25,58,25,67,33,54,75,92,79,100,46,88,54,88,37,79,62,71,88,50,46,88,71,104,62,96,50,67,75,96,79,83,83,79,88,58,62,88,54,92,79,92,109,79,71,75,71,79,83,67,79,88,79,83,79,
226,153,76,29,31,47,65,162,230,237,165,104,27,42,56,131,235,253,219,128,63,47,54,24,49,81,92,79,74,144,196,205,219,203,171,94,47,24,33,18,42,29,110,185,214,201,153,70,13,9,11,11,38,99,165,149,76,4,0,2,0,2,74,137,99,15,4,0,0,0,0,13,81,124,83,52,31,40,45,56,74,63,38,40,85,119,149,135,137,128,124,126,140,149,160,147,153,142,156,147,147,147,149,169,128,137,144,142,124,117,151,144,135,144,147,144,149,140,153,144,144,140,162,153,128,140,156,147,158,147,158,160,151,142,149,153,147,144,153,149,153,149,160,142,
180,120,71,28,24,40,93,195,215,188,113,33,26,31,66,160,255,253,193,100,33,26,46,71,75,44,51,37,75,104,164,182,206,186,126,71,24,26,20,15,17,26,108,184,191,164,97,22,11,8,11,31,91,155,148,71,8,4,0,2,0,2,82,135,84,6,4,0,0,0,0,73,115,100,62,33,26,44,68,82,104,93,88,104,144,142,133,133,137,137,131,128,151,151,151,146,155,155,146,148,148,146,153,140,142,140,142,137,137,142,135,140,135,137,128,126,155,153,142,151,144,151,140,135,142,146,155,146,137,144,151,135,142,137,140,135,140,142,137,133,126,117,133,142,
137,94,73,39,33,91,228,255,252,176,88,63,36,33,164,255,255,252,185,94,42,27,73,173,167,91,91,73,124,185,185,131,176,222,146,70,33,27,24,21,54,97,191,191,179,155,76,21,15,12,45,131,222,207,158,24,12,6,0,3,0,57,149,167,140,21,6,0,0,0,30,106,158,112,94,51,57,100,143,158,143,140,161,182,188,198,213,195,161,161,185,188,188,188,191,185,195,210,204,188,176,170,179,149,161,161,164,158,179,182,191,173,164,179,179,176,176,210,207,195,170,191,188,182,158,176,170,170,204,179,176,149,195,185,195,188,179,167,161,161,167,164,161,155,
133,106,101,57,101,167,255,255,198,133,112,96,88,125,229,255,247,193,146,91,70,70,133,185,167,106,101,109,206,242,195,99,114,135,127,86,73,65,73,80,143,177,195,120,93,80,54,13,7,5,62,198,253,219,88,15,5,0,0,15,88,180,190,174,104,31,0,0,0,52,101,156,146,130,93,62,93,133,164,193,195,193,195,211,211,208,221,203,185,159,180,180,198,203,190,187,193,190,187,185,190,185,200,174,174,180,174,174,177,200,185,180,182,172,187,169,200,185,193,172,172,167,190,185,182,180,159,164,198,180,187,200,182,156,159,153,208,180,190,190,187,156,164,174,
134,98,111,78,106,179,222,187,134,86,103,103,101,141,225,250,192,111,88,78,60,98,177,174,126,96,98,139,240,253,174,83,53,73,60,68,83,81,124,154,182,184,162,86,45,22,12,10,5,7,83,174,240,197,60,12,2,0,0,32,136,169,144,113,20,0,0,0,20,111,154,156,139,134,113,98,134,146,182,199,199,197,189,182,172,194,182,187,164,164,169,182,187,187,184,179,172,172,184,164,179,167,182,164,179,151,187,179,192,167,172,179,164,149,156,169,189,159,164,174,187,177,167,192,184,187,174,174,172,174,179,189,164,164,184,172,162,149,172,159,167,172,192,174,
75,92,115,96,109,186,176,130,86,92,111,102,111,157,197,197,140,88,75,81,121,167,192,146,90,79,130,207,253,211,115,46,54,52,71,92,113,121,144,167,123,90,71,56,44,10,10,8,8,56,132,180,199,155,62,10,2,0,0,77,151,161,94,20,2,0,0,0,71,136,151,169,140,125,100,113,136,144,174,192,186,178,163,169,190,174,192,201,163,153,165,159,186,159,169,165,178,161,163,153,148,142,155,151,182,176,163,172,167,163,159,167,159,146,165,153,165,148,144,155,155,146,163,174,161,163,161,146,153,165,163,161,151,157,163,151,144,144,157,153,144,159,161,165,
71,59,71,114,133,171,126,94,61,71,63,92,147,184,163,131,83,61,69,94,143,167,151,83,63,114,196,253,237,176,94,40,32,40,73,96,131,153,186,141,88,53,49,40,22,8,8,6,28,83,126,108,108,102,51,8,0,0,10,112,145,126,51,0,0,0,0,4,100,137,171,151,137,120,120,126,120,143,171,180,157,159,147,153,178,176,171,163,163,147,141,151,167,163,151,147,153,149,151,155,151,141,149,143,157,151,151,145,147,147,143,145,149,149,155,153,147,126,147,135,145,133,157,133,137,131,141,128,149,131,131,120,135,135,122,126,151,149,139,131,145,133,137,137,
69,65,85,139,157,159,122,83,51,77,81,149,178,194,157,114,81,88,94,110,155,167,141,81,90,182,245,253,208,126,63,34,55,59,65,94,161,192,190,126,67,40,55,40,12,14,18,40,112,149,120,59,22,14,0,0,0,10,73,149,161,141,88,38,0,0,28,81,163,173,171,153,157,151,147,139,151,171,188,182,186,176,161,165,171,178,176,165,155,167,147,147,171,176,153,167,161,165,151,167,151,149,157,143,151,145,149,143,145,149,145,135,139,139,141,149,153,145,137,139,141,141,137,135,143,149,151,153,149,145,149,116,135,137,157,139,141,141,139,128,131,128,141,122,
124,116,154,199,85,83,32,32,58,81,120,193,182,186,118,105,83,77,92,92,124,98,88,94,180,225,253,232,139,32,0,8,40,64,96,137,201,206,186,100,53,32,8,12,10,15,32,92,158,154,126,15,0,0,0,0,25,79,131,137,146,128,122,88,73,55,79,126,174,186,180,165,171,154,163,163,178,189,193,195,182,180,184,176,189,195,208,180,167,171,161,152,171,163,163,152,176,150,163,156,152,158,165,156,141,152,150,146,150,167,156,143,161,152,156,163,150,141,139,135,158,146,148,152,158,143,152,148,143,139,150,154,152,141,156,163,146,133,146,148,154,131,150,156,
62,88,132,123,160,132,136,151,75,147,195,255,192,192,158,125,91,99,97,80,104,88,91,158,231,240,203,151,69,28,0,21,34,91,179,253,236,199,166,112,21,15,0,15,4,23,67,151,173,143,91,4,0,0,0,0,86,158,177,162,143,147,151,151,151,158,186,203,221,240,221,201,199,192,192,192,192,210,236,212,203,203,199,201,203,199,221,203,205,186,201,195,186,179,188,179,184,173,166,162,173,182,169,175,177,182,177,162,169,188,175,173,164,162,156,169,179,156,151,166,160,158,158,173,173,164,153,182,156,169,171,166,177,175,169,171,158,158,140,147,153,147,166,160,
169,211,220,194,115,107,103,122,63,126,173,183,136,150,145,145,119,117,63,49,63,77,112,180,253,237,122,51,32,0,0,2,46,82,176,241,194,119,91,65,39,11,7,0,18,46,119,164,154,82,25,2,0,0,7,46,140,183,213,183,164,152,171,185,187,206,218,206,246,232,248,206,204,208,204,192,218,225,234,220,218,215,201,204,208,215,220,197,211,220,208,197,197,206,211,183,176,185,201,161,171,173,183,169,176,187,192,173,169,159,178,173,187,169,185,173,173,178,173,173,185,161,176,166,187,166,173,169,169,173,150,161,187,176,176,180,183,173,176,157,166,164,178,164,
162,207,200,155,90,100,102,102,93,164,200,167,47,50,66,76,105,83,59,62,54,98,160,203,229,184,98,28,0,0,0,0,40,112,193,203,126,43,33,40,16,14,0,7,66,136,186,193,145,74,21,9,26,50,78,145,219,231,219,200,191,186,176,198,215,222,222,236,253,231,231,234,222,219,198,212,234,243,241,239,222,207,196,217,219,215,207,222,222,196,176,193,203,196,188,198,181,172,184,188,184,176,176,188,181,169,174,172,164,164,150,162,169,164,160,167,179,174,181,191,169,164,167,162,157,160,145,169,162,153,141,145,174,186,160,162,188,179,174,167,162,164,162,150,
162,153,131,85,47,67,45,61,76,160,192,135,22,18,9,15,29,6,20,40,101,131,180,158,137,79,56,18,0,0,0,2,99,178,180,137,42,11,9,4,0,0,6,52,117,162,185,162,106,47,38,56,70,110,147,189,223,221,196,171,167,167,180,176,214,217,232,244,253,237,208,208,203,187,169,185,205,201,201,196,194,187,185,199,176,183,189,178,192,169,183,178,158,162,165,158,171,158,151,158,153,156,147,151,151,153,149,153,149,158,158,153,160,153,160,153,156,149,149,140,147,140,149,131,147,151,140,135,142,147,135,113,162,147,144,137,149,144,126,128,151,144,128,140,
188,155,88,52,7,28,33,43,71,150,193,141,38,14,28,19,0,11,35,86,174,210,196,124,45,40,35,4,0,0,0,45,162,188,172,81,11,0,0,7,35,26,57,102,210,205,215,169,102,66,81,121,133,136,198,236,246,217,200,200,198,200,219,227,241,243,246,253,246,234,231,227,222,196,200,188,203,217,212,207,193,198,200,212,210,219,212,203,188,196,176,169,184,181,174,169,186,160,164,167,167,157,160,174,162,153,155,145,157,164,157,148,157,162,164,153,155,164,164,150,148,157,148,148,157,160,153,148,145,136,143,129,141,143,150,138,164,164,150,143,160,153,160,157,
167,101,38,27,40,54,67,108,99,126,122,108,38,18,22,31,45,72,122,133,176,196,187,115,52,56,42,22,11,0,36,110,185,180,142,67,0,0,0,0,42,85,137,169,201,208,194,149,124,106,126,153,169,183,203,232,239,205,196,180,214,210,221,217,226,226,228,235,253,221,232,219,214,196,192,185,208,205,210,210,199,192,192,203,196,180,199,180,199,167,178,171,169,156,165,160,165,149,147,133,147,137,137,131,160,137,151,144,162,156,160,144,156,151,151,144,142,128,144,135,149,131,137,137,147,131,158,135,124,117,147,140,147,137,153,153,156,126,144,144,133,124,144,140,
141,66,47,26,43,57,114,114,117,93,74,59,35,14,9,0,33,102,138,133,100,114,102,71,43,45,47,19,9,57,98,150,143,109,38,0,0,0,0,0,38,136,184,219,215,212,181,145,112,119,150,179,198,219,222,253,227,207,198,191,193,215,217,236,222,229,224,222,205,227,217,198,196,198,172,184,184,203,200,186,207,179,186,176,193,184,186,164,181,150,150,141,176,150,153,155,133,141,150,129,148,143,145,126,138,143,141,121,148,131,133,124,141,133,121,121,129,126,112,105,143,117,112,119,143,129,117,133,126,114,117,121,133,129,102,129,131,124,124,141,136,126,133,141,
97,50,26,44,60,73,113,134,142,97,31,36,63,68,13,7,42,108,145,108,42,21,0,0,0,55,55,39,36,84,152,179,131,44,0,0,13,18,31,65,142,200,239,247,229,218,192,174,129,137,174,203,229,247,242,253,221,221,197,203,245,247,242,239,239,247,247,247,239,210,221,213,216,197,205,189,192,197,216,203,200,203,200,197,205,197,200,189,171,176,150,158,150,150,147,142,137,145,126,139,126,152,131,142,155,160,155,155,160,168,137,158,155,145,152,145,142,126,147,131,152,110,147,121,158,145,147,131,139,142,137,129,121,121,137,126,139,142,145,155,126,137,158,142,
52,23,2,35,63,75,120,132,120,61,0,23,78,59,37,26,66,118,160,125,49,0,0,0,0,49,87,104,94,134,158,156,66,4,0,26,75,115,130,182,210,246,236,236,205,208,205,187,175,175,194,203,239,239,243,246,253,213,215,217,229,234,239,234,236,229,231,236,229,217,220,213,203,191,191,187,203,203,208,196,182,198,179,187,182,175,179,179,156,146,163,151,160,165,160,151,142,146,134,123,149,142,146,137,139,142,127,132,144,139,139,130,137,146,134,132,130,139,139,125,118,132,123,118,142,134,137,132,127,134,123,123,134,139,146,125,142,134,134,146,127,132,134,137,
87,66,48,71,80,112,112,152,101,73,0,11,154,106,55,117,119,154,168,147,62,20,0,0,0,29,89,165,184,184,184,145,34,0,0,78,133,165,188,223,253,253,244,241,209,223,193,200,212,214,223,235,237,239,239,230,228,218,202,202,241,230,235,232,237,251,241,241,241,237,218,225,207,193,172,177,198,186,198,191,200,188,182,179,188,186,170,184,170,147,138,145,177,177,165,156,142,145,145,145,147,142,145,133,135,154,133,135,147,145,152,149,161,124,133,140,149,122,133,156,131,122,133,129,140,115,119,119,135,122,135,126,142,135,140,119,142,142,135,129,145,142,152,149,
108,65,95,78,19,21,73,27,81,2,32,0,10,5,62,81,117,136,76,138,65,0,0,0,0,0,68,168,185,174,141,117,16,0,57,130,168,187,206,234,239,253,223,223,206,215,209,204,193,212,217,220,247,239,228,223,234,206,204,204,215,206,190,204,198,220,209,204,215,204,182,179,157,157,144,138,147,176,168,155,147,144,141,152,147,127,130,138,133,122,127,138,119,114,127,114,111,95,98,92,95,98,87,100,100,81,81,95,84,89,89,87,84,92,98,92,92,89,98,111,68,81,100,92,78,68,78,81,89,84,108,92,84,76,95,98,70,70,81,100,98,84,98,84,
0,41,56,67,86,90,105,75,86,0,0,0,0,0,0,26,90,116,56,63,0,0,0,0,0,30,97,210,199,176,139,131,67,101,127,161,203,233,199,252,233,248,244,214,176,199,184,184,176,180,225,221,203,214,206,206,195,180,184,169,165,184,184,173,154,188,169,176,199,180,176,165,176,157,142,150,112,127,120,109,116,97,105,101,124,120,127,112,116,86,97,116,78,71,71,71,56,56,11,15,45,56,52,67,71,60,48,63,78,63,75,75,71,60,48,45,30,18,33,26,67,63,26,33,56,63,52,37,56,67,78,56,33,33,37,18,15,33,26,30,86,63,52,71,
4,134,113,121,155,88,109,79,117,8,0,16,92,29,50,71,121,96,71,67,41,37,20,37,58,134,201,247,213,176,142,197,134,176,201,230,222,251,226,251,222,234,218,218,201,213,209,201,205,205,222,234,226,218,251,251,163,151,113,146,184,176,159,155,176,180,167,192,155,125,130,109,109,113,113,121,117,117,109,138,113,109,92,71,92,79,71,71,58,50,37,50,54,54,71,20,29,12,8,0,37,25,8,4,37,0,16,0,29,12,0,16,8,33,4,37,0,33,8,37,0,16,33,4,0,29,8,29,0,16,0,12,29,16,4,16,0,25,0,29,29,50,12,8,
34,143,131,139,135,38,42,38,158,31,50,54,155,54,89,100,124,96,89,85,77,77,46,77,120,170,201,197,186,139,139,189,166,162,217,251,240,232,201,217,186,178,170,201,170,162,166,182,178,178,205,189,155,170,213,193,139,127,120,131,174,174,147,131,112,162,124,151,135,139,139,124,100,104,85,104,69,93,65,65,54,69,46,77,93,85,62,81,73,46,0,42,42,62,15,42,50,15,19,19,19,11,19,23,50,27,3,23,7,3,42,0,7,27,7,23,0,0,0,3,11,46,31,19,0,11,15,34,15,11,15,31,15,15,27,23,27,15,38,27,7,46,27,23,
80,185,185,203,171,84,70,84,192,112,70,119,220,143,108,101,147,161,171,185,154,157,133,136,189,238,248,227,220,217,171,185,178,224,245,252,234,241,210,234,182,217,185,203,189,203,210,220,199,203,199,220,185,217,213,231,182,133,140,157,182,129,133,140,115,150,157,178,140,140,133,136,91,112,94,87,87,105,108,126,87,73,59,77,91,126,63,91,77,52,42,45,42,45,24,38,31,31,0,31,31,28,3,42,31,21,0,49,17,17,35,24,0,14,14,0,17,17,0,14,0,0,10,3,42,24,24,24,42,42,7,24,49,24,31,24,14,49,38,38,31,35,0,21,
96,229,237,211,229,107,114,100,222,107,92,129,229,118,81,103,189,177,177,177,189,189,189,200,211,229,200,207,166,151,129,181,192,189,203,252,248,229,163,192,192,185,185,192,203,196,192,192,170,163,200,181,177,170,222,200,151,148,151,151,129,114,122,118,129,137,118,148,126,126,100,103,96,111,96,74,63,111,88,85,55,88,88,77,77,74,51,66,77,55,29,40,33,55,25,40,3,40,0,29,14,18,0,29,37,48,25,37,11,33,3,37,0,14,11,0,14,29,37,3,0,29,22,0,22,40,44,25,14,44,14,7,18,29,22,11,14,44,48,37,18,51,7,18,
184,255,255,255,248,104,160,140,255,152,184,156,252,204,196,136,244,244,248,244,244,240,236,236,244,252,248,244,236,232,196,220,236,240,244,252,248,240,236,232,232,232,236,240,236,196,216,232,196,200,224,224,224,228,232,236,216,212,192,192,192,196,192,140,144,176,140,184,184,176,148,164,164,148,68,112,88,148,108,132,100,80,104,92,84,112,128,120,60,100,48,60,44,44,60,44,40,64,52,52,60,40,32,60,40,20,0,40,4,0,0,16,4,20,0,28,16,8,40,8,0,8,32,0,8,0,16,8,28,4,36,32,36,40,0,24,8,32,20,12,44,32,24,24,
203,255,255,255,247,146,162,166,255,162,178,182,251,150,166,154,223,243,231,243,243,239,223,235,243,251,247,243,219,211,174,227,215,239,243,251,247,235,219,227,219,231,235,231,235,235,235,231,178,186,162,219,211,203,178,215,219,182,162,158,174,174,125,174,142,146,142,170,150,146,134,134,105,109,77,81,97,138,97,89,81,93,52,77,89,101,36,89,69,44,0,65,40,81,16,44,8,8,24,36,24,36,40,56,0,28,8,48,4,0,8,0,0,24,24,28,32,52,32,24,32,36,32,32,69,77,28,36,0,24,40,12,4,0,40,32,12,4,8,16,0,16,16,40,
221,255,255,255,246,221,216,231,255,221,187,201,251,211,172,118,241,241,246,241,241,236,231,231,241,251,246,241,231,226,216,236,231,236,241,251,246,236,231,226,226,226,231,236,231,231,231,226,216,211,216,216,216,221,226,231,211,201,191,196,191,196,201,211,211,206,177,191,187,182,177,172,142,191,123,93,113,147,127,113,182,108,78,98,113,108,108,73,59,68,44,44,63,24,14,29,24,83,29,59,24,19,0,14,14,0,59,24,24,24,0,0,19,0,44,34,39,63,9,4,34,9,44,68,0,29,9,4,19,49,34,59,9,44,29,39,4,54,34,14,29,44,19,0,
223,255,255,255,246,223,186,227,255,223,214,227,251,214,153,214,241,241,246,241,241,237,232,232,241,251,246,241,232,227,232,237,227,237,241,251,246,237,232,227,227,227,232,237,232,232,232,227,218,214,218,218,214,223,227,232,214,204,195,200,195,200,167,200,167,204,172,195,190,186,148,144,125,172,125,125,111,125,116,102,79,79,111,93,88,79,93,97,74,41,60,88,93,69,93,88,69,65,69,37,13,51,60,41,4,4,23,13,32,0,0,18,0,13,9,74,4,37,0,51,0,41,32,27,18,46,13,65,37,55,51,88,65,51,46,69,0,37,27,51,46,51,0,51,
208,255,255,255,242,208,208,222,255,208,208,222,249,195,195,208,235,235,242,235,235,228,222,222,235,249,242,235,222,215,222,228,222,228,235,249,242,228,222,215,215,215,222,228,222,222,222,215,202,195,202,202,202,208,215,222,195,181,168,175,168,175,181,195,195,188,181,168,161,154,148,154,161,181,114,181,188,161,148,168,168,141,175,168,134,141,134,161,107,134,67,154,121,134,141,154,74,107,80,107,40,80,0,80,6,47,53,60,0,0,47,107,60,40,26,74,0,60,0,0,33,67,20,6,67,26,26,26,80,80,67,94,74,148,94,74,0,33,94,47,0,33,0,0,
216,255,255,255,244,216,216,227,255,216,216,227,250,204,204,216,238,238,244,238,238,233,227,227,238,250,244,238,227,221,227,233,227,233,238,250,244,233,227,221,221,221,227,233,227,227,227,221,210,204,210,210,210,216,221,227,204,193,182,187,182,187,193,204,204,199,193,182,176,170,164,170,176,164,142,119,142,176,164,136,85,73,91,136,73,85,102,108,108,91,68,91,85,102,96,91,51,79,34,102,0,34,0,68,17,51,0,17,51,91,39,79,17,62,0,22,11,22,0,5,51,73,0,34,39,11,0,22,39,56,0,62,22,91,0,0,0,51,22,68,51,85,0,62
];*/
function lbp8(I, threshold) {
    var m = I.m;
    var n = I.n;
    var J = new Matrix(m,n);
    var i, j;
    var p = [[-1,-1], [-1,0], [-1,1],
             [0,-1], [0,1],
             [1,-1], [1,0], [1,1]];
    var w = [1, 2, 4, 8, 16, 32, 64, 128];
    for (i = 1; i < m-1; ++i) {
        for (j = 1; j < n-1; ++j) {
            var c = I.data[i*n+j];
            var v = 0;
            for (k = 0; k < p.length; ++k) {
                v += ((c - I.data[(i+p[k][0])*n + (j+p[k][1])]) > threshold)*w[k];
            }
            J.data[i*n+j] = v;
        }
    }
    return J;
}

function lbp(I, radius, num, threshold) {
    var m = I.m;
    var n = I.n;
    var J = new Matrix(m,n);
    var i, j, k;
    var r = new Array(num);
    var c = new Array(num);
    for (k = 0; k < num; ++k) {
        r[k] = Math.round(-radius*Math.sin(2*Math.PI*k/num));
        c[k] = Math.round(radius*Math.cos(2*Math.PI*k/num));
    }
    for (i = radius; i < m-radius; ++i) {
        for (j = radius; j < n-radius; ++j) {
            var p = I.data[i*n+j];
            var numHi = 0;
            var numLo = 0;
            for (k = 0; k < r.length; ++k) {
                var v = p - I.data[(i+r[k])*n + (j+c[k])];
                numHi += v >= threshold;
                numLo += -v >= threshold; 
            }
            //J.data[i*n+j] = 255*(numHi+numLo)/num;
            J.data[i*n+j] = 255*(numHi+numLo>=7);
        }
    }
    return J;
}

function update() {
    document.getElementById("radiusOutput").value = document.getElementById("radius").value;
    document.getElementById("numOutput").value = document.getElementById("num").value;
    document.getElementById("thresholdOutput").value = document.getElementById("threshold").value;
    J = lbp(gImage, document.getElementById("radius").value, document.getElementById("num").value, document.getElementById("threshold").value);
    drawImage(J, document.getElementById("canvasLBP"));
}

drawImage(gImage, document.getElementById("canvasImage"));
update();
</script>
</body>
</html>
